/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * JPanelIntroduccionArticulosComp.java
 *
 * Created on 01-ago-2011, 13:51:11
 */
package com.comerzzia.jpos.gui.components.ventas;

import com.comerzzia.jpos.gui.JPrincipal;
import com.comerzzia.jpos.gui.validation.ValidationFormException;
import javax.swing.JLabel;
import com.comerzzia.jpos.gui.components.form.JTextFieldForm;
import com.comerzzia.jpos.gui.validation.IViewerValidationFormError;
import com.comerzzia.jpos.gui.validation.ValidadorEntero;
import com.comerzzia.util.numeros.bigdecimal.Numero;
import java.awt.event.KeyEvent;
import javax.swing.JTextField;

/**
 *
 * @author amos
 */
public class JPanelIntroduccionArticulosComp extends javax.swing.JPanel implements IViewerValidationFormError {

    /** Creates new form JPanelIntroduccionArticulosComp */
    public JPanelIntroduccionArticulosComp() {
        initComponents();
        t_Cantidad.addValidador(new ValidadorEntero(1, 9999), this);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        t_Codigo = new com.comerzzia.jpos.gui.components.form.JTextFieldForm();
        jLabel8 = new javax.swing.JLabel();
        t_Cantidad = new com.comerzzia.jpos.gui.components.form.JTextFieldForm();

        t_Codigo.setFont(new java.awt.Font("Tahoma", 0, 18));
        t_Codigo.setNextFocusableComponent(t_Codigo);
        t_Codigo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                t_CodigoActionPerformed(evt);
            }
        });

        jLabel8.setFont(new java.awt.Font("Tahoma", 1, 18));
        jLabel8.setText("X");
        jLabel8.setFocusable(false);

        t_Cantidad.setText("1");
        t_Cantidad.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        t_Cantidad.setNextFocusableComponent(t_Codigo);
        t_Cantidad.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                t_CantidadActionPerformed(evt);
            }
        });
        t_Cantidad.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                t_CantidadFocusLost(evt);
            }
        });
        t_Cantidad.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                t_CantidadKeyTyped(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(t_Codigo, javax.swing.GroupLayout.PREFERRED_SIZE, 159, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(10, 10, 10)
                .addComponent(jLabel8)
                .addGap(18, 18, 18)
                .addComponent(t_Cantidad, javax.swing.GroupLayout.PREFERRED_SIZE, 38, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                .addComponent(t_Codigo, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addComponent(jLabel8)
                .addComponent(t_Cantidad, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void t_CodigoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_CodigoActionPerformed
}//GEN-LAST:event_t_CodigoActionPerformed

    private void t_CantidadActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_CantidadActionPerformed
}//GEN-LAST:event_t_CantidadActionPerformed

    private void t_CantidadKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_t_CantidadKeyTyped
        if (evt.getKeyChar() == '\n' || evt.getKeyCode() == KeyEvent.VK_TAB) {
            accionSalirDeCuadroCantidad();
        }
    }//GEN-LAST:event_t_CantidadKeyTyped

    private void t_CantidadFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_t_CantidadFocusLost
        accionSalirDeCuadroCantidad();
    }//GEN-LAST:event_t_CantidadFocusLost
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel jLabel8;
    private com.comerzzia.jpos.gui.components.form.JTextFieldForm t_Cantidad;
    private com.comerzzia.jpos.gui.components.form.JTextFieldForm t_Codigo;
    // End of variables declaration//GEN-END:variables

    public JLabel getjLabel8() {
        return jLabel8;
    }

    public JTextField getT_Codigo() {
        return (JTextField) t_Codigo;
    }

    public JTextFieldForm getT_Cantidad() {
        return t_Cantidad;
    }

    public void setActivo(boolean activo) {
        t_Codigo.setEnabled(activo);
        t_Cantidad.setEnabled(activo);
        // visible??
    }

    public void reset() {
        setCantidad("1");
        setCodigo("");
    }

    public String getCodArticulo() {
        return t_Codigo.getText();
    }

    public String getCantidad() {
        return t_Cantidad.getText();
    }

    public Integer getCantidadInt() {
        return Integer.parseInt(t_Cantidad.getText());
    }

    public boolean checkValores(boolean modoConCantidad) {
        try {
            // si la cantidad es vacío o errónea, ponemos 1 por defecto

            if (!modoConCantidad && getCantidad().isEmpty() || !Numero.valida(getCantidad())) {
                setCantidad("1");
            }
            else {
                t_Cantidad.validar();
            }
            return !t_Cantidad.getText().isEmpty();
        }
        catch (ValidationFormException ex) {
            addError(ex);
            return false;
        }
    }

    private void setCantidad(String text) {
        t_Cantidad.setText(text);
    }

    private void setCodigo(String text) {
        t_Codigo.setText(text);
    }

    public void setT_Cantidad(JTextFieldForm t_Cantidad) {
        this.t_Cantidad = t_Cantidad;
    }

    public void setT_Codigo(JTextFieldForm t_Codigo) {
        this.t_Codigo = t_Codigo;
    }

    public void requestFocus() {
        
        //this.t_Codigo.requestFocus();
        this.t_Codigo.requestFocusInWindow();
        this.t_Codigo.selectAll();
    }

    @Override
    public void addError(ValidationFormException e) {
        JPrincipal.getInstance().crearError(e.getMessage());
    }

    @Override
    public void clearError() {
    }

    private void accionSalirDeCuadroCantidad() {
        t_Codigo.requestFocus();
        if (t_Codigo.getText().endsWith("x")) {
            t_Codigo.setText("");
        }
    }

    public void setModoCantidad(boolean modoConCantidad) {
        t_Cantidad.setFocusable(modoConCantidad);
        t_Cantidad.setEditable(modoConCantidad);
        t_Cantidad.setValidacionHabilitada(modoConCantidad);
    }
}
